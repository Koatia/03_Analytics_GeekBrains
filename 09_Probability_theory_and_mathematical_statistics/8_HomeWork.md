### Урок 8. Корреляционный анализ

#### Задание 1

**_Даны значения величины заработной платы заемщиков банка `zp` и значения их поведенческого кредитного скоринга `ks`:_**
> zp = [35, 45, 190, 200, 40, 70, 54, 150, 120, 110]
>
> ks = [401, 574, 874, 919, 459, 739, 653, 902, 746, 832]

_**Найдите ковариацию этих двух величин с помощью элементарных действий, а затем с помощью функции cov из numpy Полученные значения должны быть равны.**_

_**Найдите коэффициент корреляции Пирсона с помощью ковариации и среднеквадратичных отклонений двух признаков, а затем с использованием функций из библиотек numpy и pandas.**_

Решение:

1. Ковариация

> Вычисление средних значений:

> $\bar{zp} = \frac{1}{n} \sum_{i=1}^{n} zp_i$
>
> $\bar{zp} = \frac{35 + 45 + 190 + 200 + 40 + 70 + 54 + 150 + 120 + 110}{10} = 101.4$

> $\bar{ks} = \frac{1}{n} \sum_{i=1}^{n} ks_i$
>
> $\bar{ks} = \frac{401 + 574 + 874 + 919 + 459 + 739 + 653 + 902 + 746 + 832}{10} = 709.9$

> Вычисление ковариации:
>
> $\text{cov}(zp, ks) = \frac{1}{n} \sum_{i=1}^{n} (zp_i - \bar{zp})(ks_i - \bar{ks})$
>
> $\text{cov}(zp, ks) = \frac{1}{10} \sum_{i=1}^{10} (zp_i - 101.4)(ks_i - 709.9)$
>
> $\text{cov}(zp, ks) = \frac{1}{10} \left( (35 - 101.4)(401 - 709.9) + (45 - 101.4)(574 - 709.9) + \ldots + (110 - 101.4)(832 - 709.9) \right) = 9157.84$

      С использованием numpy

```python
import numpy as np

# Данные
zp = np.array([35, 45, 190, 200, 40, 70, 54, 150, 120, 110])
ks = np.array([401, 574, 874, 919, 459, 739, 653, 902, 746, 832])

# Средние значения
mean_zp = np.mean(zp)
print(mean_zp)

mean_ks = np.mean(ks)
print(mean_ks)

# Ковариация вручную
cov_manual = np.sum((zp - mean_zp) * (ks - mean_ks)) / len(zp)

# Ковариация с использованием numpy
cov_numpy = np.cov(zp, ks, ddof=0)[0, 1]

print(cov_manual, cov_numpy)

9157.84 9157.84
```

2. Коэффициент корреляции Пирсона

> Вычисление среднеквадратичных отклонений:

> $\sigma_{zp} = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (zp_i - \bar{zp})^2}$
>
> $\sigma_{zp} = \sqrt{\frac{1}{10} \sum_{i=1}^{10} (zp_i - 101.4)^2} = 59.1155$

> $\sigma_{ks} = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (ks_i - \bar{ks})^2}$
>
> $\sigma_{ks} = \sqrt{\frac{1}{10} \sum_{i=1}^{10} (ks_i - 709.9)^2} = 174.5534$

> Вычисление коэффициента корреляции Пирсона:

> $r = \frac{\text{cov}(zp, ks)}{\sigma_{zp} \sigma_{ks}} = \frac{9157.84}{59.1155 \times 102.9405} = 0.8875$

      С использованием numpy и pandas

```python
# Коэффициент корреляции Пирсона вручную
std_zp = np.std(zp)
print(std_zp)
std_ks = np.std(ks)
print(std_ks)

pearson_manual = cov_manual / (std_zp * std_ks)

# Коэффициент корреляции Пирсона с использованием numpy
pearson_numpy = np.corrcoef(zp, ks)[0, 1]

# Коэффициент корреляции Пирсона с использованием pandas
# Создание DataFrame
df = pd.DataFrame({"zp": zp, "ks": ks})
pearson_pandas = df.corr().loc["zp", "ks"]

print(pearson_manual, pearson_numpy, pearson_pandas)

0.8874900920739162 0.8874900920739162 0.8874900920739168
```

Заключение

Результаты вручную и с использованием библиотек совпадают. Ковариация между заработной платой и кредитным скорингом составляет 9157.84, а коэффициент корреляции Пирсона равен 0.8875, что указывает на сильную положительную связь между этими двумя переменными.

#### Задание 2

**_Измерены значения IQ выборки студентов, обучающихся в местных технических вузах: 131, 125, 115, 122, 131, 115, 107, 99, 125, 111. Известно, что в генеральной совокупности IQ распределен нормально. Найдите доверительный интервал для математического ожидания с надежностью 0.95_**

Для нахождения доверительного интервала для математического ожидания (среднего) при известном нормальном распределении можно использовать \(t\)-распределение (распределение Стьюдента), так как объем выборки небольшой и дисперсия генеральной совокупности неизвестна.

1. Найти выборочное среднее (\(\bar{x}\)) и выборочное стандартное отклонение (\(s\)):

> $\bar{x} = \frac{1}{n} \sum_{i=1}^{n} x_i; \quad s = \sqrt{\frac{1}{n-1} \sum_{i=1}^{n} (x_i - \bar{x})^2}$

> $\bar{x} = \frac{131 + 125 + 115 + 122 + 131 + 115 + 107 + 99 + 125 + 111}{10} = \frac{1181}{10} = 118.1$
>
> $s = \sqrt{\frac{(131-118.1)^2 + (125-118.1)^2 + \ldots + (111-118.1)^2}{10-1}} = \sqrt{\frac{1001.9}{9}} = \sqrt{111.322} \approx 10.55$

2. Найти критическое значение \(t\) для заданного уровня надежности и \(n-1\) степеней свободы:

> $t_{\alpha/2} = t_{\text{crit}}$

> Критическое значение \(t\) для уровня надежности 0.95 и 9 степеней свободы:
>
> $t_{\alpha/2} \approx 2.262 \text{ (из таблицы t-распределения)}$

3. Вычислить стандартную ошибку среднего:

> $SE = \frac{s}{\sqrt{n}}; \quad SE = \frac{s}{\sqrt{10}} = \frac{10.55}{\sqrt{10}} \approx 3.34$

4. Найти границы доверительного интервала:

> $\bar{x} \pm t_{\alpha/2} \cdot SE$

> $\text{Нижняя граница} = \bar{x} - t_{\alpha/2} \cdot SE = 118.1 - 2.262 \cdot 3.34 \approx 110.54$
>
> $\text{Верхняя граница} = \bar{x} + t_{\alpha/2} \cdot SE = 118.1 + 2.262 \cdot 3.34 \approx 125.66$

Проведем эти вычисления в Python.

```python
import numpy as np
from scipy.stats import t

# Данные выборки
IQ = np.array([131, 125, 115, 122, 131, 115, 107, 99, 125, 111])

# Выборочное среднее и стандартное отклонение
mean_IQ = np.mean(IQ)
std_IQ = np.std(IQ, ddof=1)

# Размер выборки
n = len(IQ)

# Уровень надежности
confidence_level = 0.95
alpha = 1 - confidence_level

# Критическое значение t для 9 степеней свободы
t_critical = t.ppf(1 - alpha/2, df=n-1)

# Стандартная ошибка среднего
SE = std_IQ / np.sqrt(n)

# Доверительный интервал
confidence_interval = (mean_IQ - t_critical * SE, mean_IQ + t_critical * SE)

print(mean_IQ, std_IQ, t_critical, SE, confidence_interval)

118.1 10.54566788359614 2.2621571627409915 3.3348329959851224 (110.55608365158724, 125.64391634841274)
```

Заключение

Доверительный интервал для среднего значения IQ выборки студентов с надежностью 0.95 составляет (110.54, 125.66).

#### Задание 3

**_Известно, что рост футболистов в сборной распределен нормально с дисперсией генеральной совокупности, равной 25 кв.см. Объем выборки равен 27, среднее выборочное составляет 174.2. Найдите доверительный интервал для математического ожидания с надежностью 0.95_**

Для нахождения доверительного интервала для математического ожидания при известной дисперсии генеральной совокупности мы используем нормальное распределение (распределение Z).

- Дисперсия (\(\sigma^2\)) = 25 кв.см.
- Объем выборки (\(n\)) = 27
- Среднее выборочное (\(\bar{x}\)) = 174.2
- Уровень надежности = 0.95

Вычисление стандартного отклонения (\(\sigma\)):

> $\sigma = \sqrt{25} = 5$

Вычисление стандартной ошибки среднего (SE):

> $SE = \frac{\sigma}{\sqrt{n}} = \frac{5}{\sqrt{27}} \approx 0.963$

Нахождение критического значения Z для уровня надежности 0.95:

> Для уровня надежности 0.95 и двухстороннего теста ($\alpha = 1 - 0.95 = 0.05$), критическое значение $Z_{\alpha/2}$ находится из таблицы стандартного нормального распределения.
>
> $Z_{\alpha/2} = 1.96$

Границы доверительного интервала:

> $\text{Нижняя граница} = \bar{x} - Z_{\alpha/2} \cdot SE = 174.2 - 1.96 \cdot 0.963 \approx 172.3$

> $\text{Верхняя граница} = \bar{x} + Z_{\alpha/2} \cdot SE = 174.2 + 1.96 \cdot 0.963 \approx 176.1$

Заключение

Доверительный интервал для среднего роста футболистов в сборной с надежностью 0.95 составляет (172.3, 176.1)